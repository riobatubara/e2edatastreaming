"use strict";class SDKAnalytic{static version="1.0.0";static urlserver="http://localhost:9000/api";static instances=0;static tsinstance=Date.now();static payload=[];static log=!1;sdk={};sessid;key;userid;constructor(key,userid){if(SDKAnalytic.instances++,SDKAnalytic.instances>1)throw new Error("Unable to create analytic");if(""==key||null==key)throw new Error("Missing SDK key");if("number"==typeof key)throw new Error("Illegal SDK key");this.init=!0,this.userid=userid,this.key=key,this.sessid=SDKAnalytic.MD5(key+SDKAnalytic.tsinstance.toString()+userid),!1===SDKAnalytic.storage.check("_sdkAnalyticStorage")&&(this.sdk={instance:this.init,tsinstance:SDKAnalytic.tsinstance},SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(this.sdk)))}version(){return SDKAnalytic.version}log(){SDKAnalytic.log=!0}videoload(value){var _storage=JSON.parse(SDKAnalytic.storage.read("_sdkAnalyticStorage"));if(void 0===_storage.firstload){_storage.firstload=!0,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage));const videoId=value.videoId,videoName=value.videoName,uadev=SDKAnalytic.setuadev();if(SDKAnalytic.videoMeasure(this.sessid,"videoId",{value:videoId}),SDKAnalytic.videoMeasure(this.sessid,"videoName",{value:videoName}),SDKAnalytic.videoMeasure(this.sessid,"uadev",{value:uadev}),SDKAnalytic.log){var log="sessid: "+this.sessid+", label: videoId, value: "+videoId,log="sessid: "+this.sessid+", label: videoName, value: "+videoName,log="sessid: "+this.sessid+", label: uadev, value: "+uadev;console.log(log)}}}videoduration(duration){var _storage=JSON.parse(SDKAnalytic.storage.read("_sdkAnalyticStorage"));if(void 0===_storage.firstduration&&(_storage.firstduration=!0,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage)),SDKAnalytic.videoMeasure(this.sessid,"duration",{value:duration}),SDKAnalytic.log)){var log="sessid: "+this.sessid+", label: duration, value: "+duration;console.log(log)}}videobitrate(bitrate){var _storage=JSON.parse(SDKAnalytic.storage.read("_sdkAnalyticStorage"));if(void 0===_storage.firstbitrate&&(_storage.firstbitrate=!0,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage)),SDKAnalytic.videoMeasure(this.sessid,"bitrate",{value:bitrate}),SDKAnalytic.log)){var log="sessid: "+this.sessid+", label: bitrate, value: "+bitrate;console.log(log)}}videoplay(){var _storage=JSON.parse(SDKAnalytic.storage.read("_sdkAnalyticStorage"));if(void 0===_storage.firstplay&&(_storage.firstplay=!0,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage)),SDKAnalytic.videoMeasure(this.sessid,"play",{}),SDKAnalytic.log)){var log="sessid: "+this.sessid+", label: play, value: "+SDKAnalytic.tsinstance;console.log(log)}}videobuffer(){var _storage=JSON.parse(SDKAnalytic.storage.read("_sdkAnalyticStorage")),ts=(new Date).getTime(),diff;if(void 0===_storage.tsbuffer)_storage.tsbuffer=ts,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage)),SDKAnalytic.videoMeasure(this.sessid,"buffer",{});else if((ts-_storage.tsbuffer)/1e3>10&&(_storage.tsbuffer=ts,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage)),SDKAnalytic.videoMeasure(this.sessid,"buffer",{}),SDKAnalytic.log)){var log="sessid: "+this.sessid+", label: buffer, value: "+SDKAnalytic.tsinstance;console.log(log)}}videoplaying(position){var _storage=JSON.parse(SDKAnalytic.storage.read("_sdkAnalyticStorage")),ts=(new Date).getTime(),diff;if(void 0===_storage.tsplaying)_storage.tsplaying=ts,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage)),SDKAnalytic.videoMeasure(this.sessid,"playing",{value:position});else if((ts-_storage.tsplaying)/1e3>10&&(_storage.tsplaying=ts,SDKAnalytic.storage.write("_sdkAnalyticStorage",JSON.stringify(_storage)),SDKAnalytic.videoMeasure(this.sessid,"playing",{value:position}),SDKAnalytic.log)){var log="sessid: "+this.sessid+", label: playing, value: "+position;console.log(log)}}videopause(){if(SDKAnalytic.videoMeasure(this.sessid,"pause",{}),SDKAnalytic.log){var log="sessid: "+this.sessid+" label: pause value: "+SDKAnalytic.tsinstance;console.log(log)}}videoseek(position){if(SDKAnalytic.videoMeasure(this.sessid,"seek",{value:position}),SDKAnalytic.log){var log="sessid: "+this.sessid+" label: seek value: "+position;console.log(log)}}videocomplete(){if(SDKAnalytic.videoMeasure(this.sessid,"complete",{}),SDKAnalytic.log){var log="sessid: "+this.sessid+" label: complete value: "+SDKAnalytic.tsinstance;console.log(log)}}videounload(){SDKAnalytic.videoMeasure(this.sessid,"unload",{})}videoerror(message){if(SDKAnalytic.videoMeasure(this.sessid,"error",{value:message}),SDKAnalytic.log){var log="sessid: "+this.sessid+" label: error value: "+message;console.log(log)}}static videoMeasure(sessid,label,data){try{var ts=Date.now();SDKAnalytic.tsinstance=ts;var value="";switch(label){case"play":value=ts.toString();break;case"bitrate":value=data.value+",0";break;case"buffer":value=ts.toString();break;case"playing":value=ts.toString()+","+data.value;break;case"pause":value=ts.toString();break;case"seek":value=ts.toString()+","+data.value;break;case"complete":case"unload":value=ts.toString();break;case"error":value=ts.toString()+","+data.value;break;default:value=data.value}SDKAnalytic.payload.push({tsclient:Math.floor(ts/1e3),sessid:sessid,label:label,value:value})}catch(err){throw new Error(err.message)}try{var json=JSON.stringify(payload),xhr=new XMLHttpRequest;xhr.open("POST",SDKAnalytic.urlserver,!0),xhr.onreadystatechange=function(){4==xhr.readyState&&xhr.status>205&&console.log("sending data failed")},xhr.setRequestHeader("Authorization",key),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(json)}catch(err){throw new Error(err.message)}}static storage={write:function(name,value){localStorage.setItem(name,value)},read:function(name){return localStorage.getItem(name)},remove:function(name){localStorage.removeItem(name)},check:function(obj){return 0===Object.keys(obj).length}};static setuadev(){var userAgent=window.navigator.userAgent,os="";userAgent.includes("Windows")&&(os="Windows"),(userAgent.includes("iPhone")||userAgent.includes("iPad"))&&(os="IOS"),userAgent.includes("Macintosh")&&(os="Mac"),userAgent.includes("Linux")&&(os="Linux",userAgent.includes("Android")&&(os="Android"));var browser="",uadev;return userAgent.includes("UCBrowser")&&(browser="UCBrowser"),userAgent.includes("Safari")&&(browser="Safari"),(userAgent.includes("Opera")||userAgent.includes("OPR"))&&(browser="Opera"),(userAgent.includes("Edge")||userAgent.includes("EdgA")||userAgent.includes("EdgiOS")||userAgent.includes("Edg"))&&(browser="Edge"),(userAgent.includes("MSIE")||userAgent.includes("WOW"))&&(browser="Explorer"),(userAgent.includes("Firefox")||userAgent.includes("FxiOS"))&&(browser="Firefox"),(userAgent.includes("Chrome")||userAgent.includes("CriOS"))&&(browser="Chrome"),userAgent.includes("Nexus")&&(browser="Nexus"),os+","+browser+",Browser"}static MD5(string){function RotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;return lX8=2147483648&lX,lY8=2147483648&lY,lResult=(1073741823&lX)+(1073741823&lY),(lX4=1073741824&lX)&(lY4=1073741824&lY)?2147483648^lResult^lX8^lY8:lX4|lY4?1073741824&lResult?3221225472^lResult^lX8^lY8:1073741824^lResult^lX8^lY8:lResult^lX8^lY8}function F(x,y,z){return x&y|~x&z}function G(x,y,z){return x&z|y&~z}function H(x,y,z){return x^y^z}function I(x,y,z){return y^(x|~z)}function FF(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function GG(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function HH(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function II(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function ConvertToWordArray(string){for(var lWordCount,lMessageLength=string.length,lNumberOfWords_temp1=lMessageLength+8,lNumberOfWords_temp2,lNumberOfWords=16*((lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64+1),lWordArray=Array(lNumberOfWords-1),lBytePosition=0,lByteCount=0;lByteCount<lMessageLength;)lBytePosition=lByteCount%4*8,lWordArray[lWordCount=(lByteCount-lByteCount%4)/4]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition,lByteCount++;return lBytePosition=lByteCount%4*8,lWordArray[lWordCount=(lByteCount-lByteCount%4)/4]=lWordArray[lWordCount]|128<<lBytePosition,lWordArray[lNumberOfWords-2]=lMessageLength<<3,lWordArray[lNumberOfWords-1]=lMessageLength>>>29,lWordArray}function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++)WordToHexValue+=(WordToHexValue_temp="0"+(lByte=lValue>>>8*lCount&255).toString(16)).substr(WordToHexValue_temp.length-2,2);return WordToHexValue}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);c<128?utftext+=String.fromCharCode(c):c>127&&c<2048?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext}var x=Array(),k,AA,BB,CC,DD,a,b,c,d,S11=7,S12=12,S13=17,S14=22,S21=5,S22=9,S23=14,S24=20,S31=4,S32=11,S33=16,S34=23,S41=6,S42=10,S43=15,S44=21,temp;for(x=ConvertToWordArray(string=Utf8Encode(string)),a=1732584193,b=4023233417,c=2562383102,d=271733878,k=0;k<x.length;k+=16)AA=a,BB=b,CC=c,DD=d,a=FF(a,b,c,d,x[k+0],7,3614090360),d=FF(d,a,b,c,x[k+1],12,3905402710),c=FF(c,d,a,b,x[k+2],17,606105819),b=FF(b,c,d,a,x[k+3],22,3250441966),a=FF(a,b,c,d,x[k+4],7,4118548399),d=FF(d,a,b,c,x[k+5],12,1200080426),c=FF(c,d,a,b,x[k+6],17,2821735955),b=FF(b,c,d,a,x[k+7],22,4249261313),a=FF(a,b,c,d,x[k+8],7,1770035416),d=FF(d,a,b,c,x[k+9],12,2336552879),c=FF(c,d,a,b,x[k+10],17,4294925233),b=FF(b,c,d,a,x[k+11],22,2304563134),a=FF(a,b,c,d,x[k+12],7,1804603682),d=FF(d,a,b,c,x[k+13],12,4254626195),c=FF(c,d,a,b,x[k+14],17,2792965006),a=GG(a,b=FF(b,c,d,a,x[k+15],22,1236535329),c,d,x[k+1],5,4129170786),d=GG(d,a,b,c,x[k+6],9,3225465664),c=GG(c,d,a,b,x[k+11],14,643717713),b=GG(b,c,d,a,x[k+0],20,3921069994),a=GG(a,b,c,d,x[k+5],5,3593408605),d=GG(d,a,b,c,x[k+10],9,38016083),c=GG(c,d,a,b,x[k+15],14,3634488961),b=GG(b,c,d,a,x[k+4],20,3889429448),a=GG(a,b,c,d,x[k+9],5,568446438),d=GG(d,a,b,c,x[k+14],9,3275163606),c=GG(c,d,a,b,x[k+3],14,4107603335),b=GG(b,c,d,a,x[k+8],20,1163531501),a=GG(a,b,c,d,x[k+13],5,2850285829),d=GG(d,a,b,c,x[k+2],9,4243563512),c=GG(c,d,a,b,x[k+7],14,1735328473),a=HH(a,b=GG(b,c,d,a,x[k+12],20,2368359562),c,d,x[k+5],4,4294588738),d=HH(d,a,b,c,x[k+8],11,2272392833),c=HH(c,d,a,b,x[k+11],16,1839030562),b=HH(b,c,d,a,x[k+14],23,4259657740),a=HH(a,b,c,d,x[k+1],4,2763975236),d=HH(d,a,b,c,x[k+4],11,1272893353),c=HH(c,d,a,b,x[k+7],16,4139469664),b=HH(b,c,d,a,x[k+10],23,3200236656),a=HH(a,b,c,d,x[k+13],4,681279174),d=HH(d,a,b,c,x[k+0],11,3936430074),c=HH(c,d,a,b,x[k+3],16,3572445317),b=HH(b,c,d,a,x[k+6],23,76029189),a=HH(a,b,c,d,x[k+9],4,3654602809),d=HH(d,a,b,c,x[k+12],11,3873151461),c=HH(c,d,a,b,x[k+15],16,530742520),a=II(a,b=HH(b,c,d,a,x[k+2],23,3299628645),c,d,x[k+0],6,4096336452),d=II(d,a,b,c,x[k+7],10,1126891415),c=II(c,d,a,b,x[k+14],15,2878612391),b=II(b,c,d,a,x[k+5],21,4237533241),a=II(a,b,c,d,x[k+12],6,1700485571),d=II(d,a,b,c,x[k+3],10,2399980690),c=II(c,d,a,b,x[k+10],15,4293915773),b=II(b,c,d,a,x[k+1],21,2240044497),a=II(a,b,c,d,x[k+8],6,1873313359),d=II(d,a,b,c,x[k+15],10,4264355552),c=II(c,d,a,b,x[k+6],15,2734768916),b=II(b,c,d,a,x[k+13],21,1309151649),a=II(a,b,c,d,x[k+4],6,4149444226),d=II(d,a,b,c,x[k+11],10,3174756917),c=II(c,d,a,b,x[k+2],15,718787259),b=II(b,c,d,a,x[k+9],21,3951481745),a=AddUnsigned(a,AA),b=AddUnsigned(b,BB),c=AddUnsigned(c,CC),d=AddUnsigned(d,DD);return(WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d)).toLowerCase()}}